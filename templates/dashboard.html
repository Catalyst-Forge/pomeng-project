<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" /> -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  </head>

  <body class="bg-body-tertiary" style="min-height: 100vh">
    <header class="navbar navbar-expand-lg bg-primary-subtle">
      <div class="container">
        <a class="navbar-brand" href="#">Pomeng Dashboard</a>
      </div>
    </header>

    <div class="row me-0 h-100 accordion" id="accordionContent">
      <aside class="col-3">
        <nav class="nav nav-pills flex-column bg-dark-subtle p-3">
          <a
            class="nav-link active"
            id="mainContentToggle"
            href="#mainContent"
            data-bs-toggle="collapse"
            data-bs-target="#mainContent"
            aria-expanded="true"
            aria-controls="mainContent"
            >Dashboard</a
          >
          <a
            class="nav-link collapsed"
            href="#datasetContent"
            id="datasetContentToggle"
            data-bs-toggle="collapse"
            data-bs-target="#datasetContent"
            aria-expanded="false"
            aria-controls="datasetContent"
            >Dataset</a
          >
          <a href="/" class="nav-link">Homepage</a>
          <a class="nav-link mt-auto" href="{{ url_for('auth.logout') }}">Logout</a>
        </nav>
      </aside>

      <main class="col-9">
        <div class="container">
          <div id="mainContent" class="accordion-collapse collapse show" aria-labelledby="mainContentToggle" data-bs-parent="#accordionContent">
            <h1>Welcome, {{ current_user.username }}!</h1>
            <a href="{{ url_for('route.crud_test') }}">dataset</a>
            <a href="{{ url_for('auth.logout') }}">Logout</a>
          </div>

          <div id="datasetContent" class="accordion-collapse collapse" aria-labelledby="datasetContentToggle" data-bs-parent="#accordionContent">
            <h1>CRUD Operations</h1>

            <!-- GET Intents -->
            <div class="mt-3">
              <h3>Get All Intents</h3>
              <button class="btn btn-primary" onclick="getIntents()">Get Intents</button>
            </div>

            <!-- POST Intent -->
            <div class="mt-3">
              <h3>Add New Intent</h3>

              <div class="mb-3">
                <label for="postTag" class="form-label">Tag:</label>
                <input type="text" class="form-control" id="postTag" placeholder="Enter tag" />
              </div>

              <div class="mb-3">
                <label for="postPatterns" class="form-label">Patterns (comma separated):</label>
                <input type="text" class="form-control" id="postPatterns" placeholder="Enter patterns" />
              </div>

              <div class="mb-3">
                <label for="postResponses" class="form-label">Responses (comma separated):</label>
                <input type="text" class="form-control" id="postResponses" placeholder="Enter responses" />
              </div>

              <button class="btn btn-primary" onclick="addIntent()">Add Intent</button>
            </div>

            <!-- PUT (Update) Intent -->
            <div class="mt-3">
              <h3>Update Existing Intent</h3>

              <div class="mb-3">
                <label for="putTag" class="form-label">Tag to update:</label>
                <input type="text" class="form-control" id="putTag" placeholder="Enter tag" />
              </div>

              <div class="mb-3">
                <label for="putPatterns" class="form-label">New Patterns (comma separated):</label>
                <input type="text" class="form-control" id="putPatterns" placeholder="Enter new patterns" />
              </div>

              <div class="mb-3">
                <label for="putResponses" class="form-label">New Responses (comma separated):</label>
                <input type="text" class="form-control" id="putResponses" placeholder="Enter new responses" />
              </div>

              <button class="btn btn-primary" onclick="updateIntent()">Update Intent</button>
            </div>

            <!-- DELETE Intent -->
            <div class="mt-3">
              <h3>Delete Intent</h3>

              <div class="mb-3">
                <label for="deleteTag" class="form-label">Tag to delete:</label>
                <input type="text" class="form-control" id="deleteTag" placeholder="Enter tag" />
              </div>

              <button class="btn btn-primary" onclick="deleteIntent()">Delete Intent</button>
            </div>

            <!-- Result Section -->
            <div class="mt-3">
              <h3>Result</h3>
              <pre id="result"></pre>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const accordionButtons = document.querySelectorAll(".nav-link");
        const accordions = document.querySelectorAll(".accordion-collapse");
        let lastOpenedAccordion = null;

        // Event listener untuk tombol accordion
        accordionButtons.forEach((button) => {
          button.addEventListener("click", function (event) {
            const targetId = this.getAttribute("data-bs-target");
            const targetCollapse = document.querySelector(targetId);

            // Tutup accordion yang sebelumnya dibuka
            if (lastOpenedAccordion && lastOpenedAccordion !== targetCollapse) {
              lastOpenedAccordion.classList.remove("show");
            }

            // Mencegah penutupan jika accordion yang sama ditekan
            if (targetCollapse.classList.contains("show") && lastOpenedAccordion === targetCollapse) {
              event.preventDefault();
            } else {
              lastOpenedAccordion = targetCollapse;
            }

            // Update kelas "active" untuk nav-link
            accordionButtons.forEach((link) => link.classList.remove("active"));
            this.classList.add("active");
          });
        });

        // Mencegah accordion yang terbuka tertutup saat tombol yang sama ditekan
        accordions.forEach((accordion) => {
          accordion.addEventListener("hide.bs.collapse", (event) => {
            if (lastOpenedAccordion === accordion) {
              event.preventDefault();
            }
          });
        });
      });
    </script>
  </body>
</html>
